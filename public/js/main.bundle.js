!function(t){function e(e){for(var n,o,c=e[0],r=e[1],h=e[2],l=0,d=[];l<c.length;l++)o=c[l],s[o]&&d.push(s[o][0]),s[o]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);for(u&&u(e);d.length;)d.shift()();return a.push.apply(a,h||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,c=1;c<i.length;c++){var r=i[c];0!==s[r]&&(n=!1)}n&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},s={0:0},a=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var c=window.webpackJsonp=window.webpackJsonp||[],r=c.push.bind(c);c.push=e,c=c.slice();for(var h=0;h<c.length;h++)e(c[h]);var u=r;a.push([100,1]),i()}({100:function(t,e,i){"use strict";i.r(e);i(25),i(36),i(37),i(62),i(24),i(39),i(40),i(41),i(42),i(70),i(43);var n=i(13),s=i.n(n);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=c(this,r(e).call(this))).$canvas=document.querySelector(".canvas"),t.context=t.$canvas.getContext("2d"),t.$video=document.querySelector(".camera"),t.$captureButton=document.querySelector(".js-capture"),t.startCamera(),t.bind(),t}var i,n,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,s.a),i=e,(n=[{key:"bind",value:function(){var t=this;this.$captureButton.addEventListener("click",function(){t.renderCameraImageInCanvas()})}},{key:"startCamera",value:function(){var t=this;navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:600,height:600},audio:!1}).then(function(e){t.$video.srcObject=e}).catch(function(e){console.log(t.$video),alert(e)})}},{key:"stopCamera",value:function(){this.$video.srcObject.getTracks().forEach(function(t){t.stop()}),this.$video.srcObject=null}},{key:"renderCameraImageInCanvas",value:function(){var t=this.$video.width,e=this.$video.height;this.context.drawImage(this.$video,0,0,t,e),this.$video.classList.add("js-hide"),this.$captureButton.classList.add("js-hide"),this.stopCamera(),this.emit("renderCameraImage",this.context)}}])&&o(i.prototype,n),a&&o(i,a),e}();i(89),i(95),i(97),i(73),i(98);function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function v(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var S=function t(e){m(this,t),this.src="./images/sticker/sticker".concat(e,".png"),this.width=300,this.height=300,this.positionX=300,this.positionY=300},k=function(t){function e(t){var i;m(this,e),(i=f(this,p(e).call(this))).$canvas=document.querySelector(".canvas"),i.context=i.$canvas.getContext("2d"),i.magnificationRatioX=i.$canvas.width/i.$canvas.offsetWidth,i.magnificationRatioY=i.$canvas.height/i.$canvas.offsetHeight,i.$offScreen=document.createElement("canvas"),i.$offScreen.width=i.$canvas.width,i.$offScreen.height=i.$canvas.height,i.offScreenContext=i.$offScreen.getContext("2d"),i.$inactiveStickerScreen=document.createElement("canvas"),i.$inactiveStickerScreen.width=i.$canvas.width,i.$inactiveStickerScreen.height=i.$canvas.height,i.inactiveContext=i.$inactiveStickerScreen.getContext("2d"),i.$backImageScreen=document.createElement("canvas"),i.$backImageScreen.width=i.$canvas.width,i.$backImageScreen.height=i.$canvas.height,i.backImageScreenContext=i.$backImageScreen.getContext("2d"),i.backImageScreenContext.putImageData(t,0,0),i.context.drawImage(i.$backImageScreen,0,0,i.$canvas.width,i.$canvas.height),i.$stickerWrapper=document.querySelector(".sticker-wrapper"),i.$stickers=document.querySelectorAll(".js-sticker"),i.$removeStickerButton=document.querySelector(".js-removeSticker"),i.$createImageButton=document.querySelector(".js-createImageButton"),i.diffX=0,i.diffY=0,i.lastScreenX=0,i.lastScreenY=0,i.isStickerTouched=!1,i.activeSticker=null,i.inactiveStickers=[],i.aspect=1;var n=/iPhone|iPad|Android/.test(navigator.userAgent)?16:8;return i.RANGE_OFFSET=n*Math.max(i.magnificationRatioX,i.magnificationRatioY),i.LEFT_LINE=1,i.BOTTOM_LINE=2,i.RIGHT_LINE=4,i.TOP_LINE=8,i.LEFT_TOP_POINT=i.LEFT_LINE+i.TOP_LINE,i.LEFT_BOTTOM_POINT=i.LEFT_LINE+i.BOTTOM_LINE,i.RIGHT_BOTTOM_POINT=i.RIGHT_LINE+i.BOTTOM_LINE,i.RIGHT_TOP_POINT=i.RIGHT_LINE+i.TOP_LINE,i.clickProperty=0,i.$stickerWrapper.classList.remove("js-hide"),i.$removeStickerButton.classList.remove("js-hide"),i.$createImageButton.classList.remove("js-hide"),i.bind(),i}var i,n,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(e,s.a),i=e,(n=[{key:"bind",value:function(){var t=this;this.$canvas.addEventListener("mousedown",function(e){t.handleMouseDown(e)}),this.$canvas.addEventListener("mousemove",function(e){t.handleMouseMove(e)}),document.addEventListener("mouseup",function(e){t.handleMouseUp(e)}),this.$canvas.addEventListener("touchstart",function(e){t.handleTouchStart(e)}),this.$canvas.addEventListener("touchmove",function(e){t.handleTouchMove(e)}),document.addEventListener("touchend",function(e){t.handleTouchEnd(e)}),d(this.$stickers).forEach(function(e){e.addEventListener("click",function(i){t.handleClickStickerList(e,i)})}),this.$removeStickerButton.addEventListener("click",function(e){e.preventDefault(),t.inactiveStickers.length>0?(t.activeSticker=t.inactiveStickers.pop(),t.setInactiveStickersOnCanvas(),t.render()):(t.activeSticker=null,t.context.clearRect(0,0,t.$canvas.width,t.$canvas.height),t.context.drawImage(t.$backImageScreen,0,0,t.$canvas.width,t.$canvas.height))}),this.$createImageButton.addEventListener("click",function(){t.setInactiveStickersOnCanvas("create"),t.render("create"),t.createImage(),t.$stickerWrapper.classList.add("js-hide"),t.$removeStickerButton.classList.add("js-hide"),t.$createImageButton.classList.add("js-hide"),document.querySelector(".image-wrapper").classList.remove("js-hide")})}},{key:"handleMouseDown",value:function(t){this.singleTouchStart(t)}},{key:"handleMouseMove",value:function(t){this.singleTouchMove(t)}},{key:"handleMouseUp",value:function(){this.handleTouchEnd()}},{key:"handleTouchStart",value:function(t){var e=t.touches;t.preventDefault(),1===e.length?this.singleTouchStart(t):(this.doubleTouchStart(t),this.isDoubleTouched=!0),this.isTouched=!0}},{key:"handleTouchMove",value:function(t){if(this.isTouched){var e=t.touches;1===e.length?this.singleTouchMove(t):e.length>=2&&this.isDoubleTouched&&this.doubleTouchMove(t)}}},{key:"handleTouchEnd",value:function(){this.isStickerTouched=!1,this.clickProperty=0,this.isTouched=!1,this.isDoubleTouched=!1}},{key:"singleTouchStart",value:function(t){var e="touchstart"===t.type?t.touches[0].screenX:t.screenX,i="touchstart"===t.type?t.touches[0].screenY:t.screenY;this.lastScreenX=e,this.lastScreenY=i,this.judgeWhereClickOnTheSticker(t),this.isStickerTouched&&this.render()}},{key:"singleTouchMove",value:function(t){if(!1!==this.isStickerTouched){var e="touchmove"===t.type?t.touches[0].screenX:t.screenX,i="touchmove"===t.type?t.touches[0].screenY:t.screenY;this.diffX=(e-this.lastScreenX)*this.magnificationRatioX,this.diffY=(i-this.lastScreenY)*this.magnificationRatioY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.operateSticker(t),this.render(),this.lastScreenX=e,this.lastScreenY=i}}},{key:"doubleTouchStart",value:function(t){var e=t.touches,i=e[0].screenX,n=e[1].screenX,s=e[0].screenY,a=e[1].screenY;this.lastScreenX=(n+i)/2,this.lastScreenY=(a+s)/2,this.lastLength=Math.hypot(n-i,a-s),this.isDoubleTouched=!0}},{key:"doubleTouchMove",value:function(t){var e=t.touches,i=e[0].screenX,n=e[1].screenX,s=e[0].screenY,a=e[1].screenY,o=(n+i)/2,c=(a+s)/2,r=Math.hypot(n-i,a-s),h=r/this.lastLength;this.diffX=(o-this.lastScreenX)*this.magnificationRatioX,this.diffY=(c-this.lastScreenY)*this.magnificationRatioY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.pinchZoomSticker(h),this.moveSticker(),this.render(),this.lastLength=r,this.lastScreenX=o,this.lastScreenY=c}},{key:"judgeWhereClickOnTheSticker",value:function(t){console.log(t);var e=t.target.getBoundingClientRect(),i=("touchstart"===t.type?t.touches[0].clientX-window.pageXOffset-e.left:t.offsetX)*this.magnificationRatioX,n=("touchstart"===t.type?t.touches[0].clientY-window.pageYOffset-e.top:t.offsetY)*this.magnificationRatioY,s=this.activeSticker,a=this.RANGE_OFFSET,o=0,c=0,r=0,h=0;if(o=s.positionX-a,c=s.positionX+s.width+a,r=s.positionY-a,h=s.positionY+s.height+a,o<=i&&i<=c&&r<=n&&n<=h)return this.judgeClickOnTheLine(i,n,o,c,r,h),void(this.isStickerTouched=!0);for(var u=this.inactiveStickers.length-1;u>=0;u--){var l=this.inactiveStickers[u];if(o=l.positionX,c=l.positionX+l.width,r=l.positionY,h=l.positionY+l.height,o<=i&&i<=c&&r<=n&&n<=h)return this.activeTouchedSticker(u),this.setInactiveStickersOnCanvas(),void(this.isStickerTouched=!0)}}},{key:"judgeClickOnTheLine",value:function(t,e,i,n,s,a){this.judgeLeftLine(t,i),this.judgeBottomLine(e,a),this.judgeRightLine(t,n),this.judgeTopLine(e,s)}},{key:"judgeLeftLine",value:function(t,e){e<=t&&t<=e+2*this.RANGE_OFFSET&&(this.clickProperty+=this.LEFT_LINE)}},{key:"judgeBottomLine",value:function(t,e){e-2*this.RANGE_OFFSET<=t&&t<=e&&(this.clickProperty+=this.BOTTOM_LINE)}},{key:"judgeRightLine",value:function(t,e){e-2*this.RANGE_OFFSET<=t&&t<=e&&(this.clickProperty+=this.RIGHT_LINE)}},{key:"judgeTopLine",value:function(t,e){e<=t&&t<=e+2*this.RANGE_OFFSET&&(this.clickProperty+=this.TOP_LINE)}},{key:"operateSticker",value:function(t){var e=t.target.getBoundingClientRect(),i=("touchmove"===t.type?t.touches[0].clientX-window.pageXOffset-e.left:t.offsetX)*this.magnificationRatioX,n=("touchmove"===t.type?t.touches[0].clientY-window.pageYOffset-e.top:t.offsetY)*this.magnificationRatioY;0===this.clickProperty?this.moveSticker():this.resizeSticker(i,n)}},{key:"activeTouchedSticker",value:function(t){var e=this.inactiveStickers[t];this.inactiveStickers.splice(t,1),this.inactiveStickers.push(this.activeSticker),this.activeSticker=e}},{key:"moveSticker",value:function(){var t=this.activeSticker;t.positionX+=this.diffX,t.positionY+=this.diffY}},{key:"pinchZoomSticker",value:function(t){var e=this.activeSticker,i=e.width,n=e.height;this.adjustSize(i*t,n*t);var s=this.activeSticker.width-i,a=this.activeSticker.height-n;this.activeSticker.positionX-=s/2,this.activeSticker.positionY-=a/2}},{key:"resizeSticker",value:function(t,e){switch(this.clickProperty){case this.LEFT_TOP_POINT:this.handleLeftTop(t,e);break;case this.LEFT_BOTTOM_POINT:this.handleLeftBottom(t,e);break;case this.RIGHT_BOTTOM_POINT:this.handleRightBottom(t,e);break;case this.RIGHT_TOP_POINT:this.handleRightTop(t,e);break;case this.LEFT_LINE:this.handleLeft(t);break;case this.BOTTOM_LINE:this.handleBottom(e);break;case this.RIGHT_LINE:this.handleRight(t);break;case this.TOP_LINE:this.handleTop(e)}}},{key:"handleLeftTop",value:function(t,e){var i=this.activeSticker,n=i.width+i.positionX,s=i.height+i.positionY,a=n-t,o=s-e;this.adjustSize(a,o),this.activeSticker.positionX=n-this.activeSticker.width,this.activeSticker.positionY=s-this.activeSticker.height}},{key:"handleLeftBottom",value:function(t,e){var i=this.activeSticker,n=i.width+i.positionX,s=n-t,a=e-i.positionY;this.adjustSize(s,a),this.activeSticker.positionX=n-this.activeSticker.width}},{key:"handleRightBottom",value:function(t,e){var i=this.activeSticker,n=t-i.positionX,s=e-i.positionY;this.adjustSize(n,s)}},{key:"handleRightTop",value:function(t,e){var i=this.activeSticker,n=i.height+i.positionY,s=t-i.positionX,a=n-e;this.adjustSize(s,a),this.activeSticker.positionY=n-this.activeSticker.height}},{key:"handleLeft",value:function(t){var e=this.activeSticker,i=e.width+e.positionX,n=i-t,s=e.height;this.adjustSize(n,0);var a=this.activeSticker.height-s;this.activeSticker.positionX=i-this.activeSticker.width,this.activeSticker.positionY-=a/2}},{key:"handleBottom",value:function(t){var e=this.activeSticker,i=e.width,n=t-e.positionY;this.adjustSize(0,n);var s=this.activeSticker.width-i;this.activeSticker.positionX-=s/2}},{key:"handleRight",value:function(t){var e=this.activeSticker,i=t-e.positionX,n=e.height;this.adjustSize(i,0);var s=this.activeSticker.height-n;this.activeSticker.positionY-=s/2}},{key:"handleTop",value:function(t){var e=this.activeSticker,i=e.height+e.positionY,n=e.width,s=i-t;this.adjustSize(0,s);var a=this.activeSticker.width-n;this.activeSticker.positionX-=a/2,this.activeSticker.positionY=i-this.activeSticker.height}},{key:"adjustSize",value:function(t,e){var i=Math.max(t,3*this.RANGE_OFFSET),n=Math.max(e,3*this.RANGE_OFFSET);t>=e?(this.activeSticker.width=i,this.activeSticker.height=i/this.aspect):(this.activeSticker.height=n,this.activeSticker.width=n*this.aspect)}},{key:"handleClickStickerList",value:function(t,e){e.preventDefault(),this.addSticker(t),this.render()}},{key:"addSticker",value:function(t){var e=new S(t.dataset.stickerNum),i=this.inactiveStickers.length;console.log("INACTIVE_ARRAY_LENGTH = ".concat(i)),null!==this.activeSticker&&(this.inactiveStickers.push(this.activeSticker),this.setInactiveStickersOnCanvas()),this.activeSticker=e}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.offScreenContext.clearRect(0,0,this.$canvas.width,this.$canvas.height),this.offScreenContext.drawImage(this.$backImageScreen,0,0,this.$canvas.width,this.$canvas.height),this.offScreenContext.drawImage(this.$inactiveStickerScreen,0,0,this.$canvas.width,this.$canvas.height),this.drawActiveStickerOnOffscreen(t),this.context.clearRect(0,0,this.$canvas.width,this.$canvas.height),this.context.drawImage(this.$offScreen,0,0,this.$canvas.width,this.$canvas.height)}},{key:"drawActiveStickerOnOffscreen",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e=Math.max(this.magnificationRatioX,this.magnificationRatioY),i="white",n=3*e,s=1*e,a=this.activeSticker,o=new Image;o.src=a.src;var c=a.positionX,r=a.positionY,h=a.width,u=a.height;this.offScreenContext.drawImage(o,c,r,h,u),"default"===t&&(this.drawFrameLine(this.offScreenContext,c,r,h,u,i,s),this.drawCornerMark(this.offScreenContext,c,r,h,u,i,s,n))}},{key:"setInactiveStickersOnCanvas",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.inactiveContext.clearRect(0,0,this.$canvas.width,this.$canvas.height);var i=Math.max(this.magnificationRatioX,this.magnificationRatioY),n="grey",s=2*i,a=1*i,o=this.inactiveStickers,c=new Image;o.forEach(function(i){c.src=i.src;var o=i.positionX,r=i.positionY,h=i.width,u=i.height;t.inactiveContext.drawImage(c,o,r,h,u),"default"===e&&(t.drawFrameLine(t.inactiveContext,o,r,h,u,n,a),t.drawCornerMark(t.inactiveContext,o,r,h,u,n,a,s))})}},{key:"drawFrameLine",value:function(t,e,i,n,s,a,o){t.strokeStyle=a,t.lineWidth=o,t.beginPath(),t.strokeRect(e,i,n,s)}},{key:"drawCornerMark",value:function(t,e,i,n,s,a,o,c){t.strokeStyle="black",t.fillStyle="white",this.drawArc(t,e,i,o,c),this.drawArc(t,e,i+s,o,c),this.drawArc(t,e+n,i,o,c),this.drawArc(t,e+n,i+s,o,c)}},{key:"drawArc",value:function(t,e,i,n,s){t.lineWidth=n,t.beginPath(),t.arc(e,i,s,0,2*Math.PI,!1),t.stroke()}},{key:"createImage",value:function(){var t=this.$canvas.toDataURL();document.querySelector(".image").src=t}}])&&v(i.prototype,n),a&&v(i,a),e}();function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function T(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $(t,e){return($=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var O=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=b(this,w(e).call(this))).$canvas=document.querySelector(".canvas"),t.context=t.$canvas.getContext("2d"),t.magnificationRatioX=t.$canvas.width/t.$canvas.offsetWidth,t.magnificationRatioY=t.$canvas.height/t.$canvas.offsetHeight,t.$offScreen=document.createElement("canvas"),t.$offScreen.width=t.$canvas.width,t.$offScreen.height=t.$canvas.height,t.offScreenContext=t.$offScreen.getContext("2d"),t.$scaleUpButton=document.querySelector(".js-scaleUp"),t.$scaleDownButton=document.querySelector(".js-scaleDown"),t.$scaleOkButton=document.querySelector(".js-scaleOk"),t}var i,n,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$(t,e)}(e,s.a),i=e,(n=[{key:"init",value:function(t){this.$scaleUpButton.classList.remove("js-hide"),this.$scaleDownButton.classList.remove("js-hide"),this.$scaleOkButton.classList.remove("js-hide"),this.originalImage=t,this.imageWidth=this.$canvas.width,this.imageHeight=this.$canvas.height,this.lastTranslateX=0,this.lastTranslateY=0,this.lastScreenX=0,this.lastScreenY=0,this.diffX=0,this.diffY=0,this.lastLength=0,this.lastScale=1,this.positionX=0,this.positionY=0,this.renderWidth=0,this.renderHeight=0,this.isTouched=!1,this.isDoubleTouched=!1,this.bind()}},{key:"bind",value:function(){var t=this;this.handlers={mousedown:this.handleMouseDown.bind(this),mousemove:this.handleMouseMove.bind(this),mouseup:this.handleMouseUp.bind(this),touchstart:this.handleTouchStart.bind(this),touchmove:this.handleTouchMove.bind(this),touchend:this.handleTouchEnd.bind(this)},this.$canvas.addEventListener("mousedown",this.handlers.mousedown),this.$canvas.addEventListener("mousemove",this.handlers.mousemove),document.addEventListener("mouseup",this.handlers.mouseup),this.$canvas.addEventListener("touchstart",this.handlers.touchstart),this.$canvas.addEventListener("touchmove",this.handlers.touchmove),document.addEventListener("touchend",this.handlers.touchend),this.$scaleUpButton.addEventListener("click",function(e){e.preventDefault();t.resize(1.1),t.render()}),this.$scaleDownButton.addEventListener("click",function(e){e.preventDefault();t.resize(1/1.1),t.render()}),this.$scaleOkButton.addEventListener("click",function(){t.$scaleUpButton.classList.add("js-hide"),t.$scaleDownButton.classList.add("js-hide"),t.$scaleOkButton.classList.add("js-hide"),t.$canvas.removeEventListener("mousedown",t.handlers.mousedown),t.$canvas.removeEventListener("mousemove",t.handlers.mousemove),document.removeEventListener("mouseup",t.handlers.mouseup),t.$canvas.removeEventListener("touchstart",t.handlers.touchstart),t.$canvas.removeEventListener("touchmove",t.handlers.touchmove),document.removeEventListener("touchend",t.handlers.mouseup),t.emit("requestedRenderSticker",t.context)})}},{key:"handleMouseDown",value:function(t){var e=t.screenX,i=t.screenY;this.lastScreenX=e,this.lastScreenY=i,this.isTouched=!0}},{key:"handleMouseMove",value:function(t){this.isTouched&&this.singleTouchMove(t)}},{key:"handleMouseUp",value:function(){this.resetValues()}},{key:"resetValues",value:function(){this.isTouched=!1,this.isDoubleTouched=!1,this.lastTranslateX=0,this.lastTranslateY=0,this.diffX=0,this.diffY=0,this.lastScreenX=0,this.lastScreenY=0}},{key:"handleTouchStart",value:function(t){var e=t.touches;t.preventDefault(),1===e.length?this.singleTouchStart(t):(this.doubleTouchStart(t),this.isDoubleTouched=!0),this.isTouched=!0}},{key:"handleTouchMove",value:function(t){if(this.isTouched){var e=t.touches;1===e.length?this.singleTouchMove(t):e.length>=2&&this.isDoubleTouched&&this.doubleTouchMove(t)}}},{key:"handleTouchEnd",value:function(){this.resetValues()}},{key:"singleTouchStart",value:function(t){var e=t.touches;this.lastScreenX=e[0].screenX,this.lastScreenY=e[0].screenY}},{key:"doubleTouchStart",value:function(t){var e=t.touches,i=e[0].screenX,n=e[1].screenX,s=e[0].screenY,a=e[1].screenY;this.lastLength=Math.hypot(n-i,a-s),this.lastScreenX=(n+i)/2,this.lastScreenY=(a+s)/2,this.isDoubleTouched=!0}},{key:"singleTouchMove",value:function(t){var e="touchmove"===t.type?t.touches[0].screenX:t.screenX,i="touchmove"===t.type?t.touches[0].screenY:t.screenY;this.diffX=(e-this.lastScreenX)*this.magnificationRatioX,this.diffY=(i-this.lastScreenY)*this.magnificationRatioY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.moveImage(),this.render(),this.lastScreenX=e,this.lastScreenY=i}},{key:"doubleTouchMove",value:function(t){var e=t.touches,i=e[0].screenX,n=e[1].screenX,s=e[0].screenY,a=e[1].screenY,o=(n+i)/2,c=(a+s)/2,r=Math.hypot(n-i,a-s),h=r/this.lastLength;this.diffX=(o-this.lastScreenX)*this.magnificationRatioX,this.diffY=(c-this.lastScreenY)*this.magnificationRatioY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.resize(h),this.moveImage(),this.render(),this.lastLength=r,this.lastScreenX=o,this.lastScreenY=c}},{key:"resize",value:function(t){var e=Math.max(this.lastScale*t,1),i=this.positionX+this.imageWidth*this.lastScale/2,n=this.positionY+this.imageHeight*this.lastScale/2,s=i-this.$canvas.width/2,a=n-this.$canvas.height/2;this.renderWidth=this.imageWidth*e,this.renderHeight=this.imageHeight*e,this.positionX=t*s-this.renderWidth/2+this.$canvas.width/2,this.positionY=t*a-this.renderHeight/2+this.$canvas.height/2,this.lastScale=e}},{key:"moveImage",value:function(){this.positionX+=this.diffX,this.positionY+=this.diffY,this.renderWidth=this.imageWidth*this.lastScale,this.renderHeight=this.imageHeight*this.lastScale}},{key:"adjustPosition",value:function(){var t=this.renderWidth,e=this.renderHeight,i=this.positionX,n=this.positionY;i=Math.min(i,0),n=Math.min(n,0),i=Math.max(i,-(t-this.$canvas.width)),n=Math.max(n,-(e-this.$canvas.height)),this.positionX=i,this.positionY=n}},{key:"render",value:function(){this.adjustPosition(),this.context.clearRect(0,0,this.$canvas.width,this.$canvas.height),this.offScreenContext.putImageData(this.originalImage,0,0),this.context.drawImage(this.$offScreen,this.positionX,this.positionY,this.renderWidth,this.renderHeight)}}])&&T(i.prototype,n),a&&T(i,a),e}();function L(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.camera=new u,this.imageEdit=new O,this.$canvas=document.querySelector(".canvas"),this.context=this.$canvas.getContext("2d"),this.originalImage=null,this.bind()}var e,i,n;return e=t,(i=[{key:"bind",value:function(){var t=this;this.camera.on("renderCameraImage",function(e){t.originalImage=e.getImageData(0,0,t.$canvas.width,t.$canvas.height),t.imageEdit.init(t.originalImage)}),this.imageEdit.on("requestedRenderSticker",function(e){t.originalImage=e.getImageData(0,0,t.$canvas.width,t.$canvas.height),t.sticker=new k(t.originalImage)})}}])&&L(e.prototype,i),n&&L(e,n),t}())}});