!function(t){function e(e){for(var n,a,r=e[0],c=e[1],h=e[2],f=0,u=[];f<r.length;f++)a=r[f],o[a]&&u.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);for(l&&l(e);u.length;)u.shift()();return s.push.apply(s,h||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,r=1;r<i.length;r++){var c=i[r];0!==o[c]&&(n=!1)}n&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},o={0:0},s=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var r=window.webpackJsonp=window.webpackJsonp||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var l=c;s.push([56,1]),i()}({56:function(t,e,i){"use strict";i.r(e);i(68),i(72),i(73),i(24),i(74),i(64),i(86),i(87),i(89),i(91),i(54),i(93);function n(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function t(e,i){s(this,t),this.src="/public/images/sticker/sticker".concat(e,".png"),this.leftTopPoint={x:100,y:100},this.leftBottomPoint={x:100,y:200},this.rightTopPoint={x:200,y:100},this.rightBottomPoint={x:200,y:200},this.zIndex=i,this.isActive=!1},r=function(){function t(){s(this,t),this.$canvas=document.querySelector(".canvas"),this.context=this.$canvas.getContext("2d"),this.$offScreen=document.createElement("canvas"),this.$offScreen.width=this.$canvas.width,this.$offScreen.height=this.$canvas.height,this.offScreenContext=this.$offScreen.getContext("2d"),this.$backImageScreen=document.createElement("canvas"),this.$backImageScreen.width=this.$canvas.width,this.$backImageScreen.height=this.$canvas.height,this.backImageScreenContext=this.$backImageScreen.getContext("2d"),this.$video=document.querySelector(".camera"),this.$captureButton=document.querySelector(".js-capture"),this.$scaleUpButton=document.querySelector(".js-scaleUp"),this.$scaleDownButton=document.querySelector(".js-scaleDown"),this.$scaleOkButton=document.querySelector(".js-scaleOk"),this.$stickerWrapper=document.querySelector(".sticker-wrapper"),this.$stickers=document.querySelectorAll(".js-sticker"),this.phase=1,this.originalImage=null,this.imageWidth=300,this.imageHeight=300,this.scale=1,this.scale_past=1,this.imagePosition={x:0,y:0},this.imagePosition_past={x:0,y:0},this.imageGeometricCenter={x:0,y:0},this.pointerPosition={startX:0,startY:0,currentX:0,currentY:0},this.diff={x:0,y:0},this.moveImageFlag=!1,this.moveStickerFlag=!1,this.stickerId=1,this.stickersOnCanvas=[],this.startCamera(),this.bind()}var e,i,r;return e=t,(i=[{key:"bind",value:function(){var t=this;this.$captureButton.addEventListener("click",function(){t.renderCameraImageInCanvas(),t.phase=2}),this.$canvas.addEventListener("mousedown",function(e){t.handleMouseDown(e)}),document.addEventListener("mousemove",function(e){t.handleMouseMove(e)}),document.addEventListener("mouseup",function(e){t.handleMouseUp(e)}),this.$scaleUpButton.addEventListener("click",function(e){t.scale_past=t.scale,t.scale*=1.2,t.resize()}),this.$scaleDownButton.addEventListener("click",function(){t.scale_past=t.scale,t.scale*=.8,t.resize()}),this.$scaleOkButton.addEventListener("click",function(){t.$scaleUpButton.classList.add("js-hide"),t.$scaleDownButton.classList.add("js-hide"),t.$scaleOkButton.classList.add("js-hide"),t.$stickerWrapper.classList.remove("js-hide"),t.originalImage=t.context.getImageData(0,0,300,300),t.backImageScreenContext.putImageData(t.originalImage,0,0),t.phase=3}),n(this.$stickers).forEach(function(e){e.addEventListener("click",function(i){t.handleStickerClick(e,i)})})}},{key:"startCamera",value:function(){var t=this;navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:300,height:300},audio:!1}).then(function(e){t.$video.srcObject=e}).catch(function(e){console.log(t.$video),alert(e)})}},{key:"stopCamera",value:function(){this.$video.srcObject.getTracks().forEach(function(t){t.stop()}),this.$video.srcObject=null}},{key:"renderCameraImageInCanvas",value:function(){var t=this.$video.offsetWidth,e=this.$video.offsetHeight;this.context.drawImage(this.$video,0,0,t,e),this.$video.classList.add("js-hide"),this.$captureButton.classList.add("js-hide"),this.$scaleUpButton.classList.remove("js-hide"),this.$scaleDownButton.classList.remove("js-hide"),this.$scaleOkButton.classList.remove("js-hide"),this.stopCamera(),this.originalImage=this.context.getImageData(0,0,300,300)}},{key:"handleMouseDown",value:function(t){var e=this;if(2===this.phase){var i=t.screenX,n=t.screenY;this.pointerPosition.startX=i,this.pointerPosition.startY=n,this.eventTarget=t.target,this.imagePosition_past.x=this.imagePosition.x,this.imagePosition_past.y=this.imagePosition.y,console.log("pastPosition_x:"+this.imagePosition_past.x)}else 3===this.phase&&this.stickersOnCanvas.forEach(function(i){i.leftTopPoint.x<=t.offsetX&&t.offsetX<=i.rightBottomPoint.x&&t.offsetY<=i.rightBottomPoint.y&&i.leftTopPoint.y<=t.offsetY?(e.moveStickerFlag=!0,console.log("onSticker")):console.log("notOnSticker")});this.moveImageFlag=!0}},{key:"handleMouseMove",value:function(t){if(this.moveImageFlag){var e=t.screenX,i=t.screenY;this.pointerPosition.currentX=e,this.pointerPosition.currentY=i,this.diff.x=e-this.pointerPosition.startX,this.diff.y=i-this.pointerPosition.startY;var n=this.diff.x,o=this.diff.y;2===this.phase?(this.imagePosition.x=n+this.imagePosition_past.x,this.imagePosition.y=o+this.imagePosition_past.y,console.log("displacePosition:"+this.imagePosition.x),this.moveImage()):3===this.phase&&this.moveStickerFlag&&this.moveSticker()}}},{key:"handleMouseUp",value:function(t){this.moveImageFlag=!1,this.moveStickerFlag=!1,this.pointerPosition.startX=0,this.pointerPosition.startY=0,this.pointerPosition.currentX=0,this.pointerPosition.currentY=0}},{key:"resize",value:function(){this.context.clearRect(0,0,300,300),this.offScreenContext.putImageData(this.originalImage,0,0);var t=this.imageWidth*this.scale,e=this.imageHeight*this.scale;this.imageGeometricCenter.x=this.imagePosition.x+this.imageWidth*this.scale_past/2,this.imageGeometricCenter.y=this.imagePosition.y+this.imageHeight*this.scale_past/2;var i=this.imageGeometricCenter.x-150,n=this.imageGeometricCenter.y-150,o=this.scale/this.scale_past*i-t/2+150,s=this.scale/this.scale_past*n-e/2+150;this.context.drawImage(this.$offScreen,o,s,t,e),this.imagePosition.x=o,this.imagePosition.y=s}},{key:"moveImage",value:function(){this.context.clearRect(0,0,300,300),this.offScreenContext.putImageData(this.originalImage,0,0);var t=this.imagePosition.x,e=this.imagePosition.y,i=this.imageWidth*this.scale,n=this.imageHeight*this.scale;this.context.drawImage(this.$offScreen,t,e,i,n),console.log("RENDER_POINT_X:"+this.imagePosition.x)}},{key:"moveSticker",value:function(){console.log("pass")}},{key:"handleStickerClick",value:function(t,e){this.addSticker(t),this.renderSticker()}},{key:"addSticker",value:function(t){var e=new a(t.dataset.stickerNum,this.stickerId);this.stickersOnCanvas.push(e),this.stickerId++,console.log(this.stickersOnCanvas)}},{key:"renderSticker",value:function(){var t=this;console.log(this),this.offScreenContext.clearRect(0,0,300,300),this.offScreenContext.drawImage(this.$backImageScreen,0,0,300,300);var e=new Image;this.stickersOnCanvas.forEach(function(i){e.src=i.src,t.offScreenContext.drawImage(e,i.leftTopPoint.x,i.leftTopPoint.y,i.rightTopPoint.x-i.leftTopPoint.x,i.leftBottomPoint.y-i.leftTopPoint.y),t.drawFrameLine(i),t.drawCornerMark(i)}),this.context.clearRect(0,0,300,300),this.context.drawImage(this.$offScreen,0,0,300,300)}},{key:"drawFrameLine",value:function(t){this.offScreenContext.strokeStyle="white",this.offScreenContext.beginPath(),this.offScreenContext.strokeRect(t.leftTopPoint.x,t.leftTopPoint.y,t.rightTopPoint.x-t.leftTopPoint.x,t.leftBottomPoint.y-t.leftTopPoint.y)}},{key:"drawCornerMark",value:function(t){this.offScreenContext.strokeStyle="black",this.offScreenContext.fillStyle="white",this.offScreenContext.beginPath(),this.offScreenContext.arc(t.leftTopPoint.x,t.leftTopPoint.y,2,0,2*Math.PI,!1),this.offScreenContext.stroke(),this.offScreenContext.beginPath(),this.offScreenContext.arc(t.leftBottomPoint.x,t.leftBottomPoint.y,2,0,2*Math.PI,!1),this.offScreenContext.stroke(),this.offScreenContext.beginPath(),this.offScreenContext.arc(t.rightTopPoint.x,t.rightTopPoint.y,2,0,2*Math.PI,!1),this.offScreenContext.stroke(),this.offScreenContext.beginPath(),this.offScreenContext.arc(t.rightBottomPoint.x,t.rightBottomPoint.y,2,0,2*Math.PI,!1),this.offScreenContext.stroke()}}])&&o(e.prototype,i),r&&o(e,r),t}();new function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),new r}}});