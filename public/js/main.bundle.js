!function(e){function t(t){for(var s,r,a=t[0],c=t[1],h=t[2],l=0,f=[];l<a.length;l++)r=a[l],i[r]&&f.push(i[r][0]),i[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(u&&u(t);f.length;)f.shift()();return o.push.apply(o,h||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],s=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(s=!1)}s&&(o.splice(t--,1),e=r(r.s=n[0]))}return e}var s={},i={0:0},o=[];function r(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var h=0;h<a.length;h++)t(a[h]);var u=c;o.push([100,1]),n()}({100:function(e,t,n){"use strict";n.r(t);n(25),n(36),n(37),n(62),n(24),n(39),n(40),n(41),n(42),n(70),n(43);var s=n(13),i=n.n(s);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,c(t).call(this))).$canvas=document.querySelector(".canvas"),e.context=e.$canvas.getContext("2d"),e.$video=document.querySelector(".camera"),e.$captureButton=document.querySelector(".js-capture"),e.startCamera(),e.bind(),e}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,i.a),n=t,(s=[{key:"bind",value:function(){var e=this;this.$captureButton.addEventListener("click",function(){e.renderCameraImageInCanvas()})}},{key:"startCamera",value:function(){var e=this;navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:300,height:300},audio:!1}).then(function(t){e.$video.srcObject=t}).catch(function(t){console.log(e.$video),alert(t)})}},{key:"stopCamera",value:function(){this.$video.srcObject.getTracks().forEach(function(e){e.stop()}),this.$video.srcObject=null}},{key:"renderCameraImageInCanvas",value:function(){var e=this.$video.offsetWidth,t=this.$video.offsetHeight;this.context.drawImage(this.$video,0,0,e,t),this.$video.classList.add("js-hide"),this.$captureButton.classList.add("js-hide"),this.stopCamera(),this.emit("renderCameraImage",this.context)}}])&&r(n.prototype,s),o&&r(n,o),t}();n(88),n(89),n(95),n(97),n(73),n(98);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function v(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var y=function e(t,n){g(this,e),this.id=n,this.src="./images/sticker/sticker".concat(t,".png"),this.leftTopPoint={x:100,y:100},this.scale=1,this.width=100,this.height=100},m=function(e){function t(e){var n;return g(this,t),(n=v(this,p(t).call(this))).$canvas=document.querySelector(".canvas"),n.context=n.$canvas.getContext("2d"),n.$offScreen=document.createElement("canvas"),n.$offScreen.width=n.$canvas.width,n.$offScreen.height=n.$canvas.height,n.offScreenContext=n.$offScreen.getContext("2d"),n.$backImageScreen=document.createElement("canvas"),n.$backImageScreen.width=n.$canvas.width,n.$backImageScreen.height=n.$canvas.height,n.backImageScreenContext=n.$backImageScreen.getContext("2d"),n.backImageScreenContext.putImageData(e,0,0),n.context.drawImage(n.$backImageScreen,0,0,300,300),n.$stickerWrapper=document.querySelector(".sticker-wrapper"),n.$stickers=document.querySelectorAll(".js-sticker"),n.$removeStickerButton=document.querySelector(".js-removeSticker"),n.$createImageButton=document.querySelector(".js-createImageButton"),n.diff={x:0,y:0},n.diffX=0,n.diffY=0,n.lastScreenX=0,n.lastScreenY=0,n.isStickerTouched=!1,n.stickerId=0,n.activeStickerId=0,n.stickersOnCanvas=[],n.stickerPosition_past={x:0,y:0},n.stickerSize_past={width:0,height:0},n.aspect=1,n.RANGE_OFFSET=10,n.LEFT_LINE=1,n.BOTTOM_LINE=2,n.RIGHT_LINE=4,n.TOP_LINE=8,n.LEFT_TOP_POINT=n.LEFT_LINE+n.TOP_LINE,n.LEFT_BOTTOM_POINT=n.LEFT_LINE+n.BOTTOM_LINE,n.RIGHT_BOTTOM_POINT=n.RIGHT_LINE+n.BOTTOM_LINE,n.RIGHT_TOP_POINT=n.RIGHT_LINE+n.TOP_LINE,n.clickProperty=0,n.$stickerWrapper.classList.remove("js-hide"),n.$removeStickerButton.classList.remove("js-hide"),n.$createImageButton.classList.remove("js-hide"),n.bind(),n}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,i.a),n=t,(s=[{key:"bind",value:function(){var e=this;this.$canvas.addEventListener("mousedown",function(t){e.handleMouseDown(t)}),this.$canvas.addEventListener("mousemove",function(t){e.handleMouseMove(t)}),document.addEventListener("mouseup",function(t){e.handleMouseUp(t)}),this.$canvas.addEventListener("touchstart",function(t){e.handleTouchStart(t)}),this.$canvas.addEventListener("touchmove",function(t){e.handleTouchMove(t)}),document.addEventListener("touchend",function(t){e.handleTouchEnd(t)}),f(this.$stickers).forEach(function(t){t.addEventListener("click",function(n){e.handleClickStickerList(t,n)})}),this.$removeStickerButton.addEventListener("click",function(){e.stickersOnCanvas.splice(e.stickersOnCanvas.length-1,1),e.renderStickers()}),this.$createImageButton.addEventListener("click",function(){e.renderOutputImage(),e.$stickerWrapper.classList.add("js-hide"),e.$removeStickerButton.classList.add("js-hide"),e.$createImageButton.classList.add("js-hide"),e.createImage(),document.querySelector(".image-wrapper").classList.remove("js-hide")})}},{key:"handleMouseDown",value:function(e){this.singleTouchStart(e)}},{key:"handleMouseMove",value:function(e){this.singleTouchMove(e)}},{key:"handleMouseUp",value:function(){this.isStickerTouched=!1,this.clickProperty=0}},{key:"handleTouchStart",value:function(e){var t=e.touches;e.preventDefault(),1===t.length?this.singleTouchStart(e):(this.doubleTouchStart(e),this.isDoubleTouched=!0),this.isTouched=!0}},{key:"handleTouchMove",value:function(e){if(this.isTouched){var t=e.touches;1===t.length?this.singleTouchMove(e):t.length>=2&&this.isDoubleTouched&&this.doubleTouchMove(e)}}},{key:"handleTouchEnd",value:function(){this.handleMouseUp(),this.isTouched=!1,this.isDoubleTouched=!1}},{key:"singleTouchStart",value:function(e){var t="touchstart"===e.type?e.touches[0].screenX:e.screenX,n="touchstart"===e.type?e.touches[0].screenY:e.screenY;this.lastScreenX=t,this.lastScreenY=n,this.isStickerTouched=this.judgeWhereClickOnTheSticker(e),this.isStickerTouched&&(this.decideOperatedSticker(e),this.renderStickers())}},{key:"singleTouchMove",value:function(e){if(!1!==this.isStickerTouched){var t="touchmove"===e.type?e.touches[0].screenX:e.screenX,n="touchmove"===e.type?e.touches[0].screenY:e.screenY;this.diffX=t-this.lastScreenX,this.diffY=n-this.lastScreenY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.operateSticker(e),this.renderStickers(),this.lastScreenX=t,this.lastScreenY=n}}},{key:"doubleTouchStart",value:function(e){var t=e.touches,n=t[0].screenX,s=t[1].screenX,i=t[0].screenY,o=t[1].screenY;this.lastScreenX=(s+n)/2,this.lastScreenY=(o+i)/2,this.lastLength=Math.hypot(s-n,o-i),this.isDoubleTouched=!0}},{key:"doubleTouchMove",value:function(e){console.log("doubleTouchMove  Start");var t=e.touches,n=t[0].screenX,s=t[1].screenX,i=t[0].screenY,o=t[1].screenY,r=(s+n)/2,a=(o+i)/2,c=Math.hypot(s-n,o-i),h=c/this.lastLength;this.diffX=r-this.lastScreenX,this.diffY=a-this.lastScreenY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.pinchSticker(h),this.moveSticker(),this.renderStickers(),this.lastLength=c,this.lastScreenX=r,this.lastScreenY=a}},{key:"judgeWhereClickOnTheSticker",value:function(e){console.log(e);for(var t=e.target.getBoundingClientRect(),n="touchstart"===e.type?e.touches[0].clientX-window.pageXOffset-t.left:e.offsetX,s="touchstart"===e.type?e.touches[0].clientY-window.pageYOffset-t.top:e.offsetY,i=!1,o=0;o<this.stickersOnCanvas.length;o++){var r=this.stickersOnCanvas[o],a=r.leftTopPoint.x,c=r.leftTopPoint.x+r.width*r.scale,h=r.leftTopPoint.y,u=r.leftTopPoint.y+r.height*r.scale;o===this.stickersOnCanvas.length-1&&(a-=this.RANGE_OFFSET,c+=this.RANGE_OFFSET,h-=this.RANGE_OFFSET,u+=this.RANGE_OFFSET),a<=n&&n<=c&&h<=s&&s<=u?(this.activeStickerId=r.id,o===this.stickersOnCanvas.length-1&&this.judgeClickOnTheLine(n,s,a,c,h,u),console.log("onSticker"),i=!0):console.log("notOnSticker")}return i}},{key:"judgeClickOnTheLine",value:function(e,t,n,s,i,o){this.judgeLeftLine(e,n),this.judgeBottomLine(t,o),this.judgeRightLine(e,s),this.judgeTopLine(t,i)}},{key:"judgeLeftLine",value:function(e,t){t<=e&&e<=t+2*this.RANGE_OFFSET&&(this.clickProperty+=this.LEFT_LINE)}},{key:"judgeBottomLine",value:function(e,t){t-2*this.RANGE_OFFSET<=e&&e<=t&&(this.clickProperty+=this.BOTTOM_LINE)}},{key:"judgeRightLine",value:function(e,t){t-2*this.RANGE_OFFSET<=e&&e<=t&&(this.clickProperty+=this.RIGHT_LINE)}},{key:"judgeTopLine",value:function(e,t){t<=e&&e<=t+2*this.RANGE_OFFSET&&(this.clickProperty+=this.TOP_LINE)}},{key:"operateSticker",value:function(e){var t=e.target.getBoundingClientRect(),n="touchmove"===e.type?e.touches[0].clientX-window.pageXOffset-t.left:e.offsetX,s="touchmove"===e.type?e.touches[0].clientY-window.pageYOffset-t.top:e.offsetY;0===this.clickProperty?this.moveSticker():this.resizeSticker(n,s)}},{key:"decideOperatedSticker",value:function(){var e=this,t=this.stickersOnCanvas.findIndex(function(t){return t.id===e.activeStickerId}),n=this.stickersOnCanvas[t];this.stickersOnCanvas.splice(t,1),this.stickersOnCanvas.push(n),this.stickerPosition_past.x=this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x,this.stickerPosition_past.y=this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y,this.stickerSize_past.width=this.stickersOnCanvas[this.stickersOnCanvas.length-1].width,this.stickerSize_past.height=this.stickersOnCanvas[this.stickersOnCanvas.length-1].height}},{key:"moveSticker",value:function(){this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x+=this.diffX,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y+=this.diffY}},{key:"pinchSticker",value:function(e){var t=this.stickersOnCanvas[this.stickersOnCanvas.length-1],n=t.width*t.scale*(e-1),s=t.height*t.scale*(e-1);this.stickersOnCanvas[this.stickersOnCanvas.length-1].scale*=e,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x-=n/2,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y-=s/2}},{key:"resizeSticker",value:function(e,t){switch(this.clickProperty){case this.LEFT_TOP_POINT:console.log("left top point"),this.resizeHandleLeftTop(e,t);break;case this.LEFT_BOTTOM_POINT:console.log("left bottom point"),this.resizeHandleLeftBottom(e,t);break;case this.RIGHT_BOTTOM_POINT:console.log("right bottom point"),this.resizeHandleRightBottom(e,t);break;case this.RIGHT_TOP_POINT:console.log("right top point"),this.resizeHandleRightTop(e,t)}}},{key:"resizeHandleLeftTop",value:function(e,t){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],s=n.width*n.scale+n.leftTopPoint.x,i=n.height*n.scale+n.leftTopPoint.y,o=s-e,r=i-t;this.adjustSizing(o,r),this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x=s-this.stickersOnCanvas[this.stickersOnCanvas.length-1].width,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y=i-this.stickersOnCanvas[this.stickersOnCanvas.length-1].height}},{key:"resizeHandleLeftBottom",value:function(e,t){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],s=n.width*n.scale+n.leftTopPoint.x,i=s-e,o=t-n.leftTopPoint.y;this.adjustSizing(i,o),this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x=s-this.stickersOnCanvas[this.stickersOnCanvas.length-1].width}},{key:"resizeHandleRightBottom",value:function(e,t){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],s=(e-n.leftTopPoint.x)*n.scale,i=(t-n.leftTopPoint.y)*n.scale;this.adjustSizing(s,i)}},{key:"resizeHandleRightTop",value:function(e,t){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],s=n.height*n.scale+n.leftTopPoint.y,i=e-n.leftTopPoint.x,o=s-t;this.adjustSizing(i,o),this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y=s-this.stickersOnCanvas[this.stickersOnCanvas.length-1].height}},{key:"adjustSizing",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];e>=t?(this.stickersOnCanvas[this.stickersOnCanvas.length-1].width=e,this.stickersOnCanvas[this.stickersOnCanvas.length-1].height=e*this.aspect):(this.stickersOnCanvas[this.stickersOnCanvas.length-1].width=t*this.aspect,this.stickersOnCanvas[this.stickersOnCanvas.length-1].height=t)}},{key:"handleClickStickerList",value:function(e){this.addSticker(e),this.renderStickers()}},{key:"addSticker",value:function(e){var t=new y(e.dataset.stickerNum,this.stickerId);this.stickersOnCanvas.push(t),this.activeStickerId=this.stickerId,this.stickerId++}},{key:"renderStickers",value:function(){this.offScreenContext.clearRect(0,0,300,300),this.offScreenContext.drawImage(this.$backImageScreen,0,0,300,300);for(var e=new Image,t="grey",n=2,s=0;s<this.stickersOnCanvas.length;s++){s===this.stickersOnCanvas.length-1&&(t="white",n=3),e.src=this.stickersOnCanvas[s].src;var i=this.stickersOnCanvas[s].leftTopPoint.x,o=this.stickersOnCanvas[s].leftTopPoint.y,r=this.stickersOnCanvas[s].width*this.stickersOnCanvas[s].scale,a=this.stickersOnCanvas[s].height*this.stickersOnCanvas[s].scale;this.offScreenContext.drawImage(e,i,o,r,a),this.drawFrameLine(i,o,r,a,t),this.drawCornerMark(i,o,r,a,n)}this.context.clearRect(0,0,300,300),this.context.drawImage(this.$offScreen,0,0,300,300)}},{key:"drawFrameLine",value:function(e,t,n,s,i){this.offScreenContext.strokeStyle=i,this.offScreenContext.beginPath(),this.offScreenContext.strokeRect(e,t,n,s)}},{key:"drawCornerMark",value:function(e,t,n,s,i){this.offScreenContext.strokeStyle="black",this.offScreenContext.fillStyle="white",this.drawArc(e,t,i),this.drawArc(e,t+s,i),this.drawArc(e+n,t,i),this.drawArc(e+n,t+s,i)}},{key:"drawArc",value:function(e,t,n){this.offScreenContext.beginPath(),this.offScreenContext.arc(e,t,n,0,2*Math.PI,!1),this.offScreenContext.stroke()}},{key:"renderOutputImage",value:function(){this.offScreenContext.clearRect(0,0,300,300),this.offScreenContext.drawImage(this.$backImageScreen,0,0,300,300);for(var e=new Image,t=0;t<this.stickersOnCanvas.length;t++){e.src=this.stickersOnCanvas[t].src;var n=this.stickersOnCanvas[t].leftTopPoint.x,s=this.stickersOnCanvas[t].leftTopPoint.y,i=this.stickersOnCanvas[t].width*this.stickersOnCanvas[t].scale,o=this.stickersOnCanvas[t].height*this.stickersOnCanvas[t].scale;this.offScreenContext.drawImage(e,n,s,i,o)}this.context.clearRect(0,0,300,300),this.context.drawImage(this.$offScreen,0,0,300,300)}},{key:"createImage",value:function(){var e=this.$canvas.toDataURL();document.querySelector(".image").src=e}}])&&d(n.prototype,s),o&&d(n,o),t}();function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function T(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=T(this,b(t).call(this))).$canvas=document.querySelector(".canvas"),e.context=e.$canvas.getContext("2d"),e.$offScreen=document.createElement("canvas"),e.$offScreen.width=e.$canvas.width,e.$offScreen.height=e.$canvas.height,e.offScreenContext=e.$offScreen.getContext("2d"),e.$scaleUpButton=document.querySelector(".js-scaleUp"),e.$scaleDownButton=document.querySelector(".js-scaleDown"),e.$scaleOkButton=document.querySelector(".js-scaleOk"),e}var n,s,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,i.a),n=t,(s=[{key:"init",value:function(e){this.$scaleUpButton.classList.remove("js-hide"),this.$scaleDownButton.classList.remove("js-hide"),this.$scaleOkButton.classList.remove("js-hide"),this.originalImage=e,this.imageWidth=300,this.imageHeight=300,this.lastTranslateX=0,this.lastTranslateY=0,this.lastScreenX=0,this.lastScreenY=0,this.diffX=0,this.diffY=0,this.lastLength=0,this.lastScale=1,this.positionX=0,this.positionY=0,this.renderWidth=0,this.renderHeight=0,this.isTouched=!1,this.isDoubleTouched=!1,this.bind()}},{key:"bind",value:function(){var e=this;this.handlers={mousedown:this.handleMouseDown.bind(this),mousemove:this.handleMouseMove.bind(this),mouseup:this.handleMouseUp.bind(this),touchstart:this.handleTouchStart.bind(this),touchmove:this.handleTouchMove.bind(this),touchend:this.handleTouchEnd.bind(this)},this.$canvas.addEventListener("mousedown",this.handlers.mousedown),this.$canvas.addEventListener("mousemove",this.handlers.mousemove),document.addEventListener("mouseup",this.handlers.mouseup),this.$canvas.addEventListener("touchstart",this.handlers.touchstart),this.$canvas.addEventListener("touchmove",this.handlers.touchmove),document.addEventListener("touchend",this.handlers.touchend),this.$scaleUpButton.addEventListener("click",function(t){t.preventDefault();e.resize(1.1),e.render()}),this.$scaleDownButton.addEventListener("click",function(t){t.preventDefault();e.resize(1/1.1),e.render()}),this.$scaleOkButton.addEventListener("click",function(){e.$scaleUpButton.classList.add("js-hide"),e.$scaleDownButton.classList.add("js-hide"),e.$scaleOkButton.classList.add("js-hide"),e.$canvas.removeEventListener("mousedown",e.handlers.mousedown),e.$canvas.removeEventListener("mousemove",e.handlers.mousemove),document.removeEventListener("mouseup",e.handlers.mouseup),e.$canvas.removeEventListener("touchstart",e.handlers.touchstart),e.$canvas.removeEventListener("touchmove",e.handlers.touchmove),document.removeEventListener("touchend",e.handlers.mouseup),e.emit("requestedRenderSticker",e.context)})}},{key:"handleMouseDown",value:function(e){var t=e.screenX,n=e.screenY;this.lastScreenX=t,this.lastScreenY=n,this.isTouched=!0}},{key:"handleMouseMove",value:function(e){this.isTouched&&this.singleTouchMove(e)}},{key:"handleMouseUp",value:function(){this.resetValues()}},{key:"resetValues",value:function(){this.isTouched=!1,this.isDoubleTouched=!1,this.lastTranslateX=0,this.lastTranslateY=0,this.diffX=0,this.diffY=0,this.lastScreenX=0,this.lastScreenY=0}},{key:"handleTouchStart",value:function(e){var t=e.touches;e.preventDefault(),1===t.length?this.singleTouchStart(e):(this.doubleTouchStart(e),this.isDoubleTouched=!0),this.isTouched=!0}},{key:"handleTouchMove",value:function(e){if(this.isTouched){var t=e.touches;1===t.length?this.singleTouchMove(e):t.length>=2&&this.isDoubleTouched&&this.doubleTouchMove(e)}}},{key:"handleTouchEnd",value:function(){this.resetValues()}},{key:"singleTouchStart",value:function(e){var t=e.touches;this.lastScreenX=t[0].screenX,this.lastScreenY=t[0].screenY}},{key:"doubleTouchStart",value:function(e){var t=e.touches,n=t[0].screenX,s=t[1].screenX,i=t[0].screenY,o=t[1].screenY;this.lastLength=Math.hypot(s-n,o-i),this.lastScreenX=(s+n)/2,this.lastScreenY=(o+i)/2,this.isDoubleTouched=!0}},{key:"singleTouchMove",value:function(e){var t="touchmove"===e.type?e.touches[0].screenX:e.screenX,n="touchmove"===e.type?e.touches[0].screenY:e.screenY;this.diffX=t-this.lastScreenX,this.diffY=n-this.lastScreenY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.moveImage(),this.render(),this.lastScreenX=t,this.lastScreenY=n}},{key:"doubleTouchMove",value:function(e){var t=e.touches,n=t[0].screenX,s=t[1].screenX,i=t[0].screenY,o=t[1].screenY,r=(s+n)/2,a=(o+i)/2,c=Math.hypot(s-n,o-i),h=c/this.lastLength;this.diffX=r-this.lastScreenX,this.diffY=a-this.lastScreenY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.resize(h),this.moveImage(),this.render(),this.lastLength=c,this.lastScreenX=r,this.lastScreenY=a}},{key:"resize",value:function(e){var t=this.lastScale*e,n=this.positionX+this.imageWidth*this.lastScale/2-150,s=this.positionY+this.imageHeight*this.lastScale/2-150;this.renderWidth=this.imageWidth*t,this.renderHeight=this.imageHeight*t,this.positionX=e*n-this.renderWidth/2+150,this.positionY=e*s-this.renderHeight/2+150,this.lastScale=t}},{key:"moveImage",value:function(){this.positionX+=this.diffX,this.positionY+=this.diffY,this.renderWidth=this.imageWidth*this.lastScale,this.renderHeight=this.imageHeight*this.lastScale}},{key:"adjustSize",value:function(){}},{key:"render",value:function(){this.adjustSize(),this.context.clearRect(0,0,300,300),this.offScreenContext.putImageData(this.originalImage,0,0),this.context.drawImage(this.$offScreen,this.positionX,this.positionY,this.renderWidth,this.renderHeight)}}])&&O(n.prototype,s),o&&O(n,o),t}();function I(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=new u,this.imageEdit=new w,this.$canvas=document.querySelector(".canvas"),this.context=this.$canvas.getContext("2d"),this.originalImage=null,this.bind()}var t,n,s;return t=e,(n=[{key:"bind",value:function(){var e=this;this.camera.on("renderCameraImage",function(t){e.originalImage=t.getImageData(0,0,300,300),e.imageEdit.init(e.originalImage)}),this.imageEdit.on("requestedRenderSticker",function(t){e.originalImage=t.getImageData(0,0,300,300),e.sticker=new m(e.originalImage)})}}])&&I(t.prototype,n),s&&I(t,s),e}())}});