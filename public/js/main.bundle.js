!function(t){function e(e){for(var i,a,r=e[0],c=e[1],h=e[2],l=0,f=[];l<r.length;l++)a=r[l],s[a]&&f.push(s[a][0]),s[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);for(u&&u(e);f.length;)f.shift()();return o.push.apply(o,h||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],i=!0,r=1;r<n.length;r++){var c=n[r];0!==s[c]&&(i=!1)}i&&(o.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},s={0:0},o=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var r=window.webpackJsonp=window.webpackJsonp||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var u=c;o.push([100,1]),n()}({100:function(t,e,n){"use strict";n.r(e);n(25),n(36),n(37),n(62),n(24),n(39),n(40),n(41),n(42),n(70),n(43);var i=n(13),s=n.n(i);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=r(this,c(e).call(this))).$canvas=document.querySelector(".canvas"),t.context=t.$canvas.getContext("2d"),t.$video=document.querySelector(".camera"),t.$captureButton=document.querySelector(".js-capture"),t.startCamera(),t.bind(),t}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,s.a),n=e,(i=[{key:"bind",value:function(){var t=this;this.$captureButton.addEventListener("click",function(){t.renderCameraImageInCanvas()})}},{key:"startCamera",value:function(){var t=this;navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:600,height:600},audio:!1}).then(function(e){t.$video.srcObject=e}).catch(function(e){console.log(t.$video),alert(e)})}},{key:"stopCamera",value:function(){this.$video.srcObject.getTracks().forEach(function(t){t.stop()}),this.$video.srcObject=null}},{key:"renderCameraImageInCanvas",value:function(){var t=this.$video.width,e=this.$video.height;this.context.drawImage(this.$video,0,0,t,e),this.$video.classList.add("js-hide"),this.$captureButton.classList.add("js-hide"),this.stopCamera(),this.emit("renderCameraImage",this.context)}}])&&a(n.prototype,i),o&&a(n,o),e}();n(88),n(89),n(95),n(97),n(73),n(98);function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function v(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var m=function t(e,n){k(this,t),this.id=n,this.src="./images/sticker/sticker".concat(e,".png"),this.leftTopPoint={x:100,y:100},this.width=100,this.height=100},y=function(t){function e(t){var n;return k(this,e),(n=v(this,g(e).call(this))).$canvas=document.querySelector(".canvas"),n.context=n.$canvas.getContext("2d"),n.$offScreen=document.createElement("canvas"),n.$offScreen.width=n.$canvas.width,n.$offScreen.height=n.$canvas.height,n.offScreenContext=n.$offScreen.getContext("2d"),n.$backImageScreen=document.createElement("canvas"),n.$backImageScreen.width=n.$canvas.width,n.$backImageScreen.height=n.$canvas.height,n.backImageScreenContext=n.$backImageScreen.getContext("2d"),n.backImageScreenContext.putImageData(t,0,0),n.context.drawImage(n.$backImageScreen,0,0,300,300),n.$stickerWrapper=document.querySelector(".sticker-wrapper"),n.$stickers=document.querySelectorAll(".js-sticker"),n.$removeStickerButton=document.querySelector(".js-removeSticker"),n.$createImageButton=document.querySelector(".js-createImageButton"),n.diff={x:0,y:0},n.diffX=0,n.diffY=0,n.lastScreenX=0,n.lastScreenY=0,n.isStickerTouched=!1,n.stickerId=0,n.activeStickerId=0,n.stickersOnCanvas=[],n.stickerPosition_past={x:0,y:0},n.stickerSize_past={width:0,height:0},n.aspect=1,n.RANGE_OFFSET=15,n.LEFT_LINE=1,n.BOTTOM_LINE=2,n.RIGHT_LINE=4,n.TOP_LINE=8,n.LEFT_TOP_POINT=n.LEFT_LINE+n.TOP_LINE,n.LEFT_BOTTOM_POINT=n.LEFT_LINE+n.BOTTOM_LINE,n.RIGHT_BOTTOM_POINT=n.RIGHT_LINE+n.BOTTOM_LINE,n.RIGHT_TOP_POINT=n.RIGHT_LINE+n.TOP_LINE,n.clickProperty=0,n.$stickerWrapper.classList.remove("js-hide"),n.$removeStickerButton.classList.remove("js-hide"),n.$createImageButton.classList.remove("js-hide"),n.bind(),n}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(e,s.a),n=e,(i=[{key:"bind",value:function(){var t=this;this.$canvas.addEventListener("mousedown",function(e){t.handleMouseDown(e)}),this.$canvas.addEventListener("mousemove",function(e){t.handleMouseMove(e)}),document.addEventListener("mouseup",function(e){t.handleMouseUp(e)}),this.$canvas.addEventListener("touchstart",function(e){t.handleTouchStart(e)}),this.$canvas.addEventListener("touchmove",function(e){t.handleTouchMove(e)}),document.addEventListener("touchend",function(e){t.handleTouchEnd(e)}),f(this.$stickers).forEach(function(e){e.addEventListener("click",function(n){t.handleClickStickerList(e,n)})}),this.$removeStickerButton.addEventListener("click",function(e){e.preventDefault(),t.stickersOnCanvas.splice(t.stickersOnCanvas.length-1,1),t.renderStickers()}),this.$createImageButton.addEventListener("click",function(){t.renderOutputImage(),t.$stickerWrapper.classList.add("js-hide"),t.$removeStickerButton.classList.add("js-hide"),t.$createImageButton.classList.add("js-hide"),t.createImage(),document.querySelector(".image-wrapper").classList.remove("js-hide")})}},{key:"handleMouseDown",value:function(t){this.singleTouchStart(t)}},{key:"handleMouseMove",value:function(t){this.singleTouchMove(t)}},{key:"handleMouseUp",value:function(){this.isStickerTouched=!1,this.clickProperty=0}},{key:"handleTouchStart",value:function(t){var e=t.touches;t.preventDefault(),1===e.length?this.singleTouchStart(t):(this.doubleTouchStart(t),this.isDoubleTouched=!0),this.isTouched=!0}},{key:"handleTouchMove",value:function(t){if(this.isTouched){var e=t.touches;1===e.length?this.singleTouchMove(t):e.length>=2&&this.isDoubleTouched&&this.doubleTouchMove(t)}}},{key:"handleTouchEnd",value:function(){this.handleMouseUp(),this.isTouched=!1,this.isDoubleTouched=!1}},{key:"singleTouchStart",value:function(t){var e="touchstart"===t.type?t.touches[0].screenX:t.screenX,n="touchstart"===t.type?t.touches[0].screenY:t.screenY;this.lastScreenX=e,this.lastScreenY=n,this.isStickerTouched=this.judgeWhereClickOnTheSticker(t),this.isStickerTouched&&(this.decideOperatedSticker(t),this.renderStickers())}},{key:"singleTouchMove",value:function(t){if(!1!==this.isStickerTouched){var e="touchmove"===t.type?t.touches[0].screenX:t.screenX,n="touchmove"===t.type?t.touches[0].screenY:t.screenY;this.diffX=e-this.lastScreenX,this.diffY=n-this.lastScreenY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.operateSticker(t),this.renderStickers(),this.lastScreenX=e,this.lastScreenY=n}}},{key:"doubleTouchStart",value:function(t){var e=t.touches,n=e[0].screenX,i=e[1].screenX,s=e[0].screenY,o=e[1].screenY;this.lastScreenX=(i+n)/2,this.lastScreenY=(o+s)/2,this.lastLength=Math.hypot(i-n,o-s),this.isDoubleTouched=!0}},{key:"doubleTouchMove",value:function(t){console.log("doubleTouchMove  Start");var e=t.touches,n=e[0].screenX,i=e[1].screenX,s=e[0].screenY,o=e[1].screenY,a=(i+n)/2,r=(o+s)/2,c=Math.hypot(i-n,o-s),h=c/this.lastLength;this.diffX=a-this.lastScreenX,this.diffY=r-this.lastScreenY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.pinchSticker(h),this.moveSticker(),this.renderStickers(),this.lastLength=c,this.lastScreenX=a,this.lastScreenY=r}},{key:"judgeWhereClickOnTheSticker",value:function(t){console.log(t);for(var e=t.target.getBoundingClientRect(),n="touchstart"===t.type?t.touches[0].clientX-window.pageXOffset-e.left:t.offsetX,i="touchstart"===t.type?t.touches[0].clientY-window.pageYOffset-e.top:t.offsetY,s=!1,o=0,a=this.stickersOnCanvas.length;o<a;o++){var r=this.stickersOnCanvas[o],c=r.leftTopPoint.x,h=r.leftTopPoint.x+r.width,u=r.leftTopPoint.y,l=r.leftTopPoint.y+r.height;o===this.stickersOnCanvas.length-1&&(c-=this.RANGE_OFFSET,h+=this.RANGE_OFFSET,u-=this.RANGE_OFFSET,l+=this.RANGE_OFFSET),c<=n&&n<=h&&u<=i&&i<=l?(this.activeStickerId=r.id,o===this.stickersOnCanvas.length-1&&this.judgeClickOnTheLine(n,i,c,h,u,l),console.log("onSticker"),s=!0):console.log("notOnSticker")}return s}},{key:"judgeClickOnTheLine",value:function(t,e,n,i,s,o){this.judgeLeftLine(t,n),this.judgeBottomLine(e,o),this.judgeRightLine(t,i),this.judgeTopLine(e,s)}},{key:"judgeLeftLine",value:function(t,e){e<=t&&t<=e+2*this.RANGE_OFFSET&&(this.clickProperty+=this.LEFT_LINE)}},{key:"judgeBottomLine",value:function(t,e){e-2*this.RANGE_OFFSET<=t&&t<=e&&(this.clickProperty+=this.BOTTOM_LINE)}},{key:"judgeRightLine",value:function(t,e){e-2*this.RANGE_OFFSET<=t&&t<=e&&(this.clickProperty+=this.RIGHT_LINE)}},{key:"judgeTopLine",value:function(t,e){e<=t&&t<=e+2*this.RANGE_OFFSET&&(this.clickProperty+=this.TOP_LINE)}},{key:"operateSticker",value:function(t){var e=t.target.getBoundingClientRect(),n="touchmove"===t.type?t.touches[0].clientX-window.pageXOffset-e.left:t.offsetX,i="touchmove"===t.type?t.touches[0].clientY-window.pageYOffset-e.top:t.offsetY;0===this.clickProperty?this.moveSticker():this.resizeSticker(n,i)}},{key:"decideOperatedSticker",value:function(){var t=this,e=this.stickersOnCanvas.findIndex(function(e){return e.id===t.activeStickerId}),n=this.stickersOnCanvas[e];this.stickersOnCanvas.splice(e,1),this.stickersOnCanvas.push(n),this.stickerPosition_past.x=this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x,this.stickerPosition_past.y=this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y,this.stickerSize_past.width=this.stickersOnCanvas[this.stickersOnCanvas.length-1].width,this.stickerSize_past.height=this.stickersOnCanvas[this.stickersOnCanvas.length-1].height}},{key:"moveSticker",value:function(){this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x+=this.diffX,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y+=this.diffY}},{key:"pinchSticker",value:function(t){var e=this.stickersOnCanvas[this.stickersOnCanvas.length-1],n=e.width*t-e.width,i=e.height*t-e.height;this.stickersOnCanvas[this.stickersOnCanvas.length-1].width*=t,this.stickersOnCanvas[this.stickersOnCanvas.length-1].height*=t,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x-=n/2,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y-=i/2}},{key:"resizeSticker",value:function(t,e){switch(this.clickProperty){case this.LEFT_TOP_POINT:console.log("left top point"),this.resizeHandleLeftTop(t,e);break;case this.LEFT_BOTTOM_POINT:console.log("left bottom point"),this.resizeHandleLeftBottom(t,e);break;case this.RIGHT_BOTTOM_POINT:console.log("right bottom point"),this.resizeHandleRightBottom(t,e);break;case this.RIGHT_TOP_POINT:console.log("right top point"),this.resizeHandleRightTop(t,e)}}},{key:"resizeHandleLeftTop",value:function(t,e){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],i=n.width+n.leftTopPoint.x,s=n.height+n.leftTopPoint.y,o=i-t,a=s-e;this.adjustSizing(o,a),this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x=i-this.stickersOnCanvas[this.stickersOnCanvas.length-1].width,this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y=s-this.stickersOnCanvas[this.stickersOnCanvas.length-1].height}},{key:"resizeHandleLeftBottom",value:function(t,e){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],i=n.width+n.leftTopPoint.x,s=i-t,o=e-n.leftTopPoint.y;this.adjustSizing(s,o),this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.x=i-this.stickersOnCanvas[this.stickersOnCanvas.length-1].width}},{key:"resizeHandleRightBottom",value:function(t,e){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],i=t-n.leftTopPoint.x,s=e-n.leftTopPoint.y;this.adjustSizing(i,s)}},{key:"resizeHandleRightTop",value:function(t,e){var n=this.stickersOnCanvas[this.stickersOnCanvas.length-1],i=n.height+n.leftTopPoint.y,s=t-n.leftTopPoint.x,o=i-e;this.adjustSizing(s,o),this.stickersOnCanvas[this.stickersOnCanvas.length-1].leftTopPoint.y=i-this.stickersOnCanvas[this.stickersOnCanvas.length-1].height}},{key:"adjustSize",value:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=this.stickersOnCanvas.length-1;console.log(t);var i=Math.max(t,3*this.RANGE_OFFSET),s=Math.max(e,3*this.RANGE_OFFSET);t>=e?(this.stickersOnCanvas[n].width=i,this.stickersOnCanvas[n].height=i*this.aspect):(this.stickersOnCanvas[n].height=s,this.stickersOnCanvas[n].width=s*this.aspect)}},{key:"handleClickStickerList",value:function(t,e){e.preventDefault(),this.addSticker(t),this.renderStickers()}},{key:"addSticker",value:function(t){var e=new m(t.dataset.stickerNum,this.stickerId);this.stickersOnCanvas.push(e),this.activeStickerId=this.stickerId,this.stickerId++}},{key:"renderStickers",value:function(){this.offScreenContext.clearRect(0,0,300,300),this.offScreenContext.drawImage(this.$backImageScreen,0,0,300,300);for(var t=new Image,e="grey",n=2,i=0,s=this.stickersOnCanvas.length;i<s;i++){i===s-1&&(e="white",n=3),t.src=this.stickersOnCanvas[i].src;var o=this.stickersOnCanvas[i].leftTopPoint.x,a=this.stickersOnCanvas[i].leftTopPoint.y,r=this.stickersOnCanvas[i].width,c=this.stickersOnCanvas[i].height;this.offScreenContext.drawImage(t,o,a,r,c),this.drawFrameLine(o,a,r,c,e),this.drawCornerMark(o,a,r,c,n)}this.context.clearRect(0,0,300,300),this.context.drawImage(this.$offScreen,0,0,300,300)}},{key:"drawFrameLine",value:function(t,e,n,i,s){this.offScreenContext.strokeStyle=s,this.offScreenContext.beginPath(),this.offScreenContext.strokeRect(t,e,n,i)}},{key:"drawCornerMark",value:function(t,e,n,i,s){this.offScreenContext.strokeStyle="black",this.offScreenContext.fillStyle="white",this.drawArc(t,e,s),this.drawArc(t,e+i,s),this.drawArc(t+n,e,s),this.drawArc(t+n,e+i,s)}},{key:"drawArc",value:function(t,e,n){this.offScreenContext.beginPath(),this.offScreenContext.arc(t,e,n,0,2*Math.PI,!1),this.offScreenContext.stroke()}},{key:"renderOutputImage",value:function(){this.offScreenContext.clearRect(0,0,300,300),this.offScreenContext.drawImage(this.$backImageScreen,0,0,300,300);for(var t=new Image,e=0,n=this.stickersOnCanvas.length;e<n;e++){t.src=this.stickersOnCanvas[e].src;var i=this.stickersOnCanvas[e].leftTopPoint.x,s=this.stickersOnCanvas[e].leftTopPoint.y,o=this.stickersOnCanvas[e].width,a=this.stickersOnCanvas[e].height;this.offScreenContext.drawImage(t,i,s,o,a)}this.context.clearRect(0,0,300,300),this.context.drawImage(this.$offScreen,0,0,300,300)}},{key:"createImage",value:function(){var t=this.$canvas.toDataURL();document.querySelector(".image").src=t}}])&&d(n.prototype,i),o&&d(n,o),e}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var w=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=T(this,b(e).call(this))).$canvas=document.querySelector(".canvas"),t.context=t.$canvas.getContext("2d"),t.$offScreen=document.createElement("canvas"),t.$offScreen.width=t.$canvas.width,t.$offScreen.height=t.$canvas.height,t.offScreenContext=t.$offScreen.getContext("2d"),t.$scaleUpButton=document.querySelector(".js-scaleUp"),t.$scaleDownButton=document.querySelector(".js-scaleDown"),t.$scaleOkButton=document.querySelector(".js-scaleOk"),t.magnificationRatioX=t.$canvas.width/t.$canvas.offsetWidth,t.magnificationRatioY=t.$canvas.height/t.$canvas.offsetHeight,t}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(e,s.a),n=e,(i=[{key:"init",value:function(t){this.$scaleUpButton.classList.remove("js-hide"),this.$scaleDownButton.classList.remove("js-hide"),this.$scaleOkButton.classList.remove("js-hide"),this.originalImage=t,this.imageWidth=this.$canvas.width,this.imageHeight=this.$canvas.height,this.lastTranslateX=0,this.lastTranslateY=0,this.lastScreenX=0,this.lastScreenY=0,this.diffX=0,this.diffY=0,this.lastLength=0,this.lastScale=1,this.positionX=0,this.positionY=0,this.renderWidth=0,this.renderHeight=0,this.isTouched=!1,this.isDoubleTouched=!1,this.bind()}},{key:"bind",value:function(){var t=this;this.handlers={mousedown:this.handleMouseDown.bind(this),mousemove:this.handleMouseMove.bind(this),mouseup:this.handleMouseUp.bind(this),touchstart:this.handleTouchStart.bind(this),touchmove:this.handleTouchMove.bind(this),touchend:this.handleTouchEnd.bind(this)},this.$canvas.addEventListener("mousedown",this.handlers.mousedown),this.$canvas.addEventListener("mousemove",this.handlers.mousemove),document.addEventListener("mouseup",this.handlers.mouseup),this.$canvas.addEventListener("touchstart",this.handlers.touchstart),this.$canvas.addEventListener("touchmove",this.handlers.touchmove),document.addEventListener("touchend",this.handlers.touchend),this.$scaleUpButton.addEventListener("click",function(e){e.preventDefault();t.resize(1.1),t.render()}),this.$scaleDownButton.addEventListener("click",function(e){e.preventDefault();t.resize(1/1.1),t.render()}),this.$scaleOkButton.addEventListener("click",function(){t.$scaleUpButton.classList.add("js-hide"),t.$scaleDownButton.classList.add("js-hide"),t.$scaleOkButton.classList.add("js-hide"),t.$canvas.removeEventListener("mousedown",t.handlers.mousedown),t.$canvas.removeEventListener("mousemove",t.handlers.mousemove),document.removeEventListener("mouseup",t.handlers.mouseup),t.$canvas.removeEventListener("touchstart",t.handlers.touchstart),t.$canvas.removeEventListener("touchmove",t.handlers.touchmove),document.removeEventListener("touchend",t.handlers.mouseup),t.emit("requestedRenderSticker",t.context)})}},{key:"handleMouseDown",value:function(t){var e=t.screenX,n=t.screenY;this.lastScreenX=e,this.lastScreenY=n,this.isTouched=!0}},{key:"handleMouseMove",value:function(t){this.isTouched&&this.singleTouchMove(t)}},{key:"handleMouseUp",value:function(){this.resetValues()}},{key:"resetValues",value:function(){this.isTouched=!1,this.isDoubleTouched=!1,this.lastTranslateX=0,this.lastTranslateY=0,this.diffX=0,this.diffY=0,this.lastScreenX=0,this.lastScreenY=0}},{key:"handleTouchStart",value:function(t){var e=t.touches;t.preventDefault(),1===e.length?this.singleTouchStart(t):(this.doubleTouchStart(t),this.isDoubleTouched=!0),this.isTouched=!0}},{key:"handleTouchMove",value:function(t){if(this.isTouched){var e=t.touches;1===e.length?this.singleTouchMove(t):e.length>=2&&this.isDoubleTouched&&this.doubleTouchMove(t)}}},{key:"handleTouchEnd",value:function(){this.resetValues()}},{key:"singleTouchStart",value:function(t){var e=t.touches;this.lastScreenX=e[0].screenX,this.lastScreenY=e[0].screenY}},{key:"doubleTouchStart",value:function(t){var e=t.touches,n=e[0].screenX,i=e[1].screenX,s=e[0].screenY,o=e[1].screenY;this.lastLength=Math.hypot(i-n,o-s),this.lastScreenX=(i+n)/2,this.lastScreenY=(o+s)/2,this.isDoubleTouched=!0}},{key:"singleTouchMove",value:function(t){var e="touchmove"===t.type?t.touches[0].screenX:t.screenX,n="touchmove"===t.type?t.touches[0].screenY:t.screenY;this.diffX=(e-this.lastScreenX)*this.magnificationRatioX,this.diffY=(n-this.lastScreenY)*this.magnificationRatioY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.moveImage(),this.render(),this.lastScreenX=e,this.lastScreenY=n}},{key:"doubleTouchMove",value:function(t){var e=t.touches,n=e[0].screenX,i=e[1].screenX,s=e[0].screenY,o=e[1].screenY,a=(i+n)/2,r=(o+s)/2,c=Math.hypot(i-n,o-s),h=c/this.lastLength;this.diffX=(a-this.lastScreenX)*this.magnificationRatioX,this.diffY=(r-this.lastScreenY)*this.magnificationRatioY,this.lastTranslateX+=this.diffX,this.lastTranslateY+=this.diffY,this.resize(h),this.moveImage(),this.render(),this.lastLength=c,this.lastScreenX=a,this.lastScreenY=r}},{key:"resize",value:function(t){var e=this.lastScale*t,n=this.positionX+this.imageWidth*this.lastScale/2,i=this.positionY+this.imageHeight*this.lastScale/2,s=n-this.$canvas.width/2,o=i-this.$canvas.height/2;this.renderWidth=this.imageWidth*e,this.renderHeight=this.imageHeight*e,this.positionX=t*s-this.renderWidth/2+this.$canvas.width/2,this.positionY=t*o-this.renderHeight/2+this.$canvas.height/2,this.lastScale=e}},{key:"moveImage",value:function(){this.positionX+=this.diffX,this.positionY+=this.diffY,this.renderWidth=this.imageWidth*this.lastScale,this.renderHeight=this.imageHeight*this.lastScale}},{key:"adjustSize",value:function(){}},{key:"render",value:function(){this.adjustSize(),this.context.clearRect(0,0,this.$canvas.width,this.$canvas.height),this.offScreenContext.putImageData(this.originalImage,0,0),this.context.drawImage(this.$offScreen,this.positionX,this.positionY,this.renderWidth,this.renderHeight)}}])&&O(n.prototype,i),o&&O(n,o),e}();function $(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.camera=new u,this.imageEdit=new w,this.$canvas=document.querySelector(".canvas"),this.context=this.$canvas.getContext("2d"),this.originalImage=null,this.bind()}var e,n,i;return e=t,(n=[{key:"bind",value:function(){var t=this;this.camera.on("renderCameraImage",function(e){t.originalImage=e.getImageData(0,0,t.$canvas.width,t.$canvas.height),t.imageEdit.init(t.originalImage)}),this.imageEdit.on("requestedRenderSticker",function(e){t.originalImage=e.getImageData(0,0,300,300),t.sticker=new y(t.originalImage)})}}])&&$(e.prototype,n),i&&$(e,i),t}())}});